package com.examplefg.malwarechecker;

import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.os.Bundle;

import com.examplefg.malwarechecker.Control.ScannerAdapter;

import java.util.ArrayList;
import java.util.List;

import butterknife.BindView;
import butterknife.ButterKnife;

public class ScannerActivity extends AppCompatActivity {

    @BindView(R.id.activity_scanner_recyclerView) RecyclerView mRecyclerView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_scanner);

        //relier les vues
        ButterKnife.bind(this);

        //configurer et afficher le RecyclerView
        this.configureRecyclerView();
    }

    //extraire les infos packages des applications installées
    private ArrayList<PackageInfo> getInstalledApplication()
    {
        ArrayList<PackageInfo> listePackages = new ArrayList<PackageInfo>();

        //recource pour extraire les infos sur les application installées
        PackageManager packageManager = this.getPackageManager();

        //extraire les application installées
        List<PackageInfo> pi = packageManager.getInstalledPackages(packageManager.GET_PERMISSIONS);//flag pour permettre extraction de permission de lappli selectionnée

        //filtrer les applications système
        for(PackageInfo packageInfo : pi)
        {
            //si l'application ne contient pas de intent de lancement alors c'est une application système
            if(packageManager.getLaunchIntentForPackage(packageInfo.packageName) != null)
            {
                listePackages.add(packageInfo);
            }
        }
        System.out.println("dkhel2");
        return listePackages;
    }

    private void configureRecyclerView() {
        //preparer les PackagesInfos
        ArrayList<PackageInfo> listePackages = this.getInstalledApplication();

        //instancier l'adapter
        ScannerAdapter adapter = new ScannerAdapter(listePackages);

        //relier l'adapter au RecyclerView
        this.mRecyclerView.setAdapter(adapter);

        //relier layout manager au RecyclerView (standard code from StackOverflow)
        this.mRecyclerView.setLayoutManager(new LinearLayoutManager(this));
    }
}
