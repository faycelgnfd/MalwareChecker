package com.examplefg.malwarechecker.Control.Utils;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;

public class PredictionHttpURLConnection {

    public static String startPredictionRequest(String urlString,String jsonString)
    {

        StringBuilder stringBuilder = new StringBuilder();

        try
        {
            //construire l'url
            URL url = new URL(urlString);

            //ouvrir une connexion
            HttpURLConnection conn = (HttpURLConnection)url.openConnection();

            //fixer la methode de requete
            conn.setRequestMethod("POST");

            //informer de l'envoie des données en format JSON
            conn.setRequestProperty("Content-Type","application/json; utf-8");

            //informer de la récéption des données en format JSON
            conn.setRequestProperty("Accept","application/json");

            //permettre a au flux d'envoyer du contenu
            conn.setDoOutput(true);

            //convertir la chaine Json pour envoie
            OutputStream os = conn.getOutputStream(); //flux de sortie pour l'envoie
            byte[] output = jsonString.getBytes("utf-8");
            os.write(output,0,output.length);

            //lire la reponse
            InputStream in = conn.getInputStream(); //flux d'entrée pour la reponse
            BufferedReader reader = new BufferedReader(new InputStreamReader(in));
            String line = null;
            while((line = reader.readLine()) != null)
            {
                stringBuilder.append(line);
            }

            //fermer les flux
            reader.close();
            in.close();
        }
        catch (MalformedURLException exception)
        {
            exception.printStackTrace();
        }
        catch (IOException exception)
        {
            exception.printStackTrace();
        }
        catch (Exception e)
        {
            e.printStackTrace();
        }

        return stringBuilder.toString();
    }
}
