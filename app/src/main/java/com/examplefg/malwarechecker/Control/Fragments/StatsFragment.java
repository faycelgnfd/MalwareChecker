package com.examplefg.malwarechecker.Control.Fragments;


import android.content.SharedPreferences;
import android.os.Bundle;

import androidx.fragment.app.Fragment;

import android.os.StatFs;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import com.examplefg.malwarechecker.R;

import butterknife.BindView;
import butterknife.ButterKnife;

import static android.content.Context.MODE_PRIVATE;

/**
 * A simple {@link Fragment} subclass.
 */
public class StatsFragment extends Fragment {

    private final String PREF_FILE_NAME = "StatFile";

    @BindView(R.id.fragment_stats_installedApps) TextView installedAppsText;
    @BindView(R.id.fragment_stats_scannedApps) TextView scannedAppsText;
    @BindView(R.id.fragment_stats_malwareDet) TextView malwareDetText;
    @BindView(R.id.fragment_stats_goodwareDet) TextView goodwareDetText;
    @BindView(R.id.fragment_stat_stockage) TextView stockageText;
    @BindView(R.id.fragment_stat_stockageAvailable) TextView stockageAvailableText;

    public StatsFragment() {
        // Required empty public constructor
    }

    public static StatsFragment getInstance()
    {
        return new StatsFragment();
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        View result = inflater.inflate(R.layout.fragment_stats, container, false);
        //relier les vues
        ButterKnife.bind(this,result);
        //afficher les stats
        updateUiWithStats();
        return result;
    }

    private void updateUiWithStats()
    {
        SharedPreferences stats = getActivity().getSharedPreferences(PREF_FILE_NAME,MODE_PRIVATE);
        scannedAppsText.setText(stats.getInt("application_scanned",0)+"\n"+getResources().getString(R.string.scanned_apps));
        goodwareDetText.setText(stats.getInt("goodwares",0)+"\n"+getResources().getString(R.string.clean_apps));
        malwareDetText.setText(stats.getInt("malwares",0)+"\n"+getResources().getString(R.string.malware_app));
        installedAppsText.setText(stats.getInt("application_installed",0)+"\n"+getResources().getString(R.string.installed_apps));
        stockageText.append(getStorage("/data")+" Gb");
        stockageAvailableText.append(getAvailableStorage("data")+" Gb");
    }

    private long getStorage(String path)
    {
        StatFs stat = new StatFs(path);
        long storage = stat.getBlockSizeLong()*stat.getBlockCountLong();

        return storage/(1048576*1024);
    }

    private long getAvailableStorage(String path)
    {
        StatFs stat = new StatFs(path);
        long storage = stat.getBlockSizeLong()*stat.getAvailableBlocksLong();

        return storage/(1048576*1024);
    }
}
